<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaiXeHoHaTinh.com - L√°i Xe H·ªô H√† Tƒ©nh - B·∫°n Qu√° Say, T√¥i ƒê∆∞a B·∫°n Quay V·ªÅ</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF6B35;
            --primary-dark: #E55A2B;
            --secondary: #004E89;
            --dark: #1A1A2E;
            --light: #F8F9FA;
            --success: #2ECC71;
            --warning: #F39C12;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header v·ªõi Hotline */
        .hotline-link {
            text-decoration: none;
            color: white;
            display: block;
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 12px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
            transition: all 0.3s ease;
        }

        .hotline-link {
            text-decoration: none;
            color: white;
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: center;
        }

        .hotline-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hotline-phone-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .hotline-icon {
            width: 45px;
            height: 45px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 1.5s infinite;
            flex-shrink: 0;
        }

        .hotline-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--primary);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255,255,255,0); }
        }

        .hotline-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .hotline-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.95;
            font-weight: 600;
        }

        .hotline-number {
            font-size: 26px;
            font-weight: 900;
            letter-spacing: 1px;
            text-decoration: none;
            color: white;
        }

        .hotline-number:hover {
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .call-badge {
            background: white;
            color: var(--primary);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            animation: badgePulse 1.5s infinite;
            white-space: nowrap;
            line-height: 1.4;
            text-align: center;
            position: relative;
        }

        .call-badge::before {
            content: '‚òéÔ∏è';
            font-size: 16px;
            margin-right: 6px;
            animation: phoneRing 1s infinite;
            display: inline-block;
        }

        @keyframes phoneRing {
            0%, 100% { transform: rotate(0deg); }
            10%, 30% { transform: rotate(-15deg); }
            20%, 40% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(255,255,255,0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 6px 25px rgba(255,255,255,0.5);
            }
        }

        .header:hover .call-badge {
            background: #FFF9F0;
            transform: scale(1.1);
        }
        
        /* Main Container */
        .main-container {
            display: flex;
            height: 100vh;
            padding-top: 70px;
        }
        
        /* Map Container */
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }

        /* ƒê·∫©y n√∫t zoom map xu·ªëng tr√°nh che header */
        .leaflet-top.leaflet-left {
            top: 80px !important;
        }
        
        /* Sidebar Form */
        .sidebar {
            width: 380px;
            background: linear-gradient(180deg, #1E1E32 0%, #16162A 100%);
            padding: 24px;
            overflow-y: auto;
            border-left: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo-section {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo-section .brand-name {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), #FFB347);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .logo-section .slogan {
            font-size: 14px;
            color: rgba(255,255,255,0.9);
            margin: 8px 0;
            font-weight: 500;
            font-style: italic;
        }

        .logo-section h1 {
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin: 12px 0 8px 0;
        }

        .logo-section .tagline {
            font-size: 12px;
            opacity: 0.8;
            color: rgba(255,255,255,0.7);
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: rgba(255,255,255,0.9);
        }
        
        .form-label .icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-label .icon.pickup { color: var(--success); }
        .form-label .icon.dropoff { color: var(--primary); }
        .form-label .icon.phone { color: var(--warning); }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.08);
            border: 2px solid transparent;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .form-input::placeholder {
            color: rgba(255,255,255,0.4);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255,255,255,0.12);
        }
        
        .form-input:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* N√∫t s·ª≠ d·ª•ng v·ªã tr√≠ hi·ªán t·∫°i */
        .use-location-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: transparent;
            border: none;
            color: var(--primary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 8px;
            padding: 0;
            transition: all 0.2s;
        }
        
        .use-location-btn:hover {
            color: #FFB347;
        }
        
        .use-location-btn svg {
            width: 14px;
            height: 14px;
        }
        
        /* Divider */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            margin: 24px 0;
        }
        
        /* N√∫t ƒë·∫∑t xe */
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .submit-btn:hover::before {
            left: 100%;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Price Display */
        .price-display {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(46, 204, 113, 0.05));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 18px;
            display: none;
        }
        
        .price-display.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
        }
        
        .price-row.total {
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 8px;
            padding-top: 12px;
        }
        
        .price-label {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
        }
        
        .price-value {
            font-weight: 600;
            color: white;
        }
        
        .price-row.total .price-label {
            font-size: 15px;
            color: white;
        }
        
        .price-row.total .price-value {
            font-size: 22px;
            font-weight: 800;
            color: var(--success);
        }
        
        /* Success Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: linear-gradient(180deg, #1E1E32 0%, #16162A 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            border: 1px solid rgba(255,255,255,0.1);
            animation: scaleIn 0.3s ease;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--success), #27AE60);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        
        .modal-icon svg {
            width: 40px;
            height: 40px;
            fill: white;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .modal-text {
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 24px;
        }
        
        .modal-order-id {
            background: rgba(255,255,255,0.08);
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 16px;
            margin-bottom: 24px;
            color: var(--primary);
        }
        
        .modal-close-btn {
            padding: 14px 40px;
            background: var(--primary);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-close-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive - Grab Style Layout */
        @media (max-width: 900px) {
            body {
                overflow: hidden;
            }

            .main-container {
                flex-direction: column;
                padding-top: 0;
                height: 100vh;
                position: relative;
            }

            /* Header - Compact cho mobile - M√†u cam */
            .header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 2000;
                padding: 10px 12px;
                background: linear-gradient(135deg, #FF6B35 0%, #E55A2B 100%);
                animation: headerPulse 1.5s infinite;
            }

            @keyframes headerPulse {
                0%, 100% { box-shadow: 0 4px 20px rgba(255, 107, 53, 0.6); }
                50% { box-shadow: 0 4px 30px rgba(255, 107, 53, 0.9); }
            }

            .hotline-container {
                gap: 12px;
                justify-content: center;
            }

            .hotline-phone-section {
                gap: 8px;
            }

            .hotline-icon {
                width: 36px;
                height: 36px;
            }

            .hotline-icon svg {
                width: 20px;
                height: 20px;
            }

            .hotline-label {
                font-size: 9px;
            }

            .hotline-number {
                font-size: 18px;
                font-weight: 900;
            }

            .call-badge {
                padding: 8px 14px;
                font-size: 11px;
                margin-left: 0;
                font-weight: 900;
                animation: badgeBounce 1s infinite;
                line-height: 1.3;
            }

            .call-badge::before {
                font-size: 14px;
                margin-right: 4px;
            }

            @keyframes badgeBounce {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.08); }
            }

            /* ƒê·∫©y n√∫t zoom xu·ªëng tr√™n mobile */
            .leaflet-top.leaflet-left {
                top: 65px !important;
            }

            /* ·∫®n logo section ho√†n to√†n */
            .logo-section {
                display: none;
            }

            /* Map fullscreen ph√≠a sau */
            .map-container {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                height: 100vh !important;
                width: 100vw !important;
                z-index: 1;
            }

            /* Sidebar = Form fixed d∆∞·ªõi */
            .sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                z-index: 1500;
                background: white;
                border-radius: 20px 20px 0 0;
                padding: 16px;
                max-height: 65vh;
                overflow-y: auto;
                box-shadow: 0 -5px 30px rgba(0,0,0,0.3);
                border: none;
                transition: transform 0.3s ease, max-height 0.3s ease;
            }

            /* Collapsed state - Thu g·ªçn */
            .sidebar.collapsed {
                max-height: auto;
                overflow: visible;
            }

            .sidebar.collapsed .form-details {
                display: none;
            }

            .sidebar.collapsed .form-summary {
                display: block;
            }

            /* Expanded state - M·ªü r·ªông */
            .sidebar:not(.collapsed) .form-details {
                display: block;
            }

            .sidebar:not(.collapsed) .form-summary {
                display: none;
            }

            /* Summary - Th√¥ng tin t√≥m t·∫Øt khi thu g·ªçn */
            .form-summary {
                display: none;
                padding: 8px 0;
            }

            .summary-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                font-size: 13px;
            }

            .summary-label {
                color: #666;
                font-weight: 500;
            }

            .summary-value {
                color: #333;
                font-weight: 600;
                text-align: right;
                max-width: 60%;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .summary-price {
                font-size: 20px;
                color: #2ECC71;
                font-weight: 900;
            }

            /* Drag handle */
            .panel-handle {
                width: 40px;
                height: 4px;
                background: #DDD;
                border-radius: 2px;
                margin: 0 auto 12px;
                cursor: pointer;
            }

            #bookingForm {
                background: white;
            }

            /* Form elements - ƒê·ªìng b·ªô m√†u desktop */
            .form-group {
                margin-bottom: 12px;
            }

            .form-label {
                font-size: 13px;
                margin-bottom: 6px;
                color: #333;
                font-weight: 600;
            }

            .form-label .icon.pickup { color: #2ECC71; }
            .form-label .icon.dropoff { color: #FF6B35; }
            .form-label .icon.phone { color: #F39C12; }

            .form-input {
                padding: 14px;
                font-size: 15px;
                background: rgba(255,255,255,0.95);
                border: 2px solid rgba(255,107,53,0.2);
                border-radius: 8px;
                color: #333;
            }

            .form-input::placeholder {
                color: #999;
            }

            .form-input:focus {
                background: white;
                border-color: #FF6B35;
                box-shadow: 0 0 0 3px rgba(255,107,53,0.1);
            }

            .use-location-btn {
                display: none;
            }

            .drag-hint {
                display: none;
            }

            .divider {
                margin: 16px 0;
                background: #E0E0E0;
            }

            /* Price display - ƒê·ªìng b·ªô m√†u desktop */
            .price-display {
                padding: 14px;
                margin-bottom: 14px;
                background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(46, 204, 113, 0.05));
                border: 1px solid rgba(46, 204, 113, 0.3);
                border-radius: 12px;
            }

            .price-row {
                padding: 5px 0;
            }

            .price-label {
                font-size: 13px;
                color: #666;
            }

            .price-value {
                font-size: 14px;
                color: #333;
                font-weight: 600;
            }

            .price-row.total .price-label {
                font-size: 15px;
                color: #333;
                font-weight: 700;
            }

            .price-row.total .price-value {
                font-size: 22px;
                font-weight: 900;
                color: #2ECC71;
            }

            /* Submit button - ƒê·ªìng b·ªô m√†u cam desktop */
            .submit-btn {
                padding: 16px;
                font-size: 16px;
                font-weight: 900;
                background: linear-gradient(135deg, #FF6B35 0%, #E55A2B 100%);
                border-radius: 12px;
                box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            }

            .submit-btn:hover {
                background: linear-gradient(135deg, #E55A2B 0%, #CC4A20 100%);
                box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
            }

            .note-text {
                font-size: 11px;
                margin-top: 10px;
                color: #999;
            }

            /* Autocomplete dropdown mobile */
            .autocomplete-dropdown {
                font-size: 14px;
                background: white;
                border: 1px solid #E0E0E0;
            }

            .autocomplete-item {
                padding: 12px 14px;
                font-size: 14px;
                color: #333;
                border-bottom: 1px solid #F5F5F5;
                line-height: 1.5;
            }

            .autocomplete-item strong {
                font-weight: 600;
                color: #FF6B35;
            }

            .autocomplete-item:hover {
                background: #F5F5F5;
            }

            /* Context menu mobile - ƒê·ªìng b·ªô m√†u */
            .map-context-menu {
                background: white;
                border: 1px solid #E0E0E0;
                border-radius: 16px;
                padding: 12px;
                min-width: 220px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            }

            .context-menu-item {
                padding: 14px 16px;
                font-size: 15px;
                border-radius: 10px;
                color: #333;
            }

            .context-menu-item.pickup {
                color: #2ECC71;
            }

            .context-menu-item.dropoff {
                color: #FF6B35;
            }

            .context-menu-item:hover {
                background: #F5F5F5;
            }

            /* Phone error mobile */
            .phone-error {
                font-size: 11px;
                color: #FF6B35;
            }
        }

        @media (max-width: 480px) {
            .hotline-number {
                font-size: 16px;
            }

            .logo-section .brand-name {
                font-size: 22px;
            }

            .map-container {
                height: 35vh;
            }

            .form-input {
                padding: 10px 12px;
                font-size: 13px;
            }
        }
        
        /* Map Markers Custom */
        .custom-marker {
            width: 30px;
            height: 30px;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pickup-marker {
            background: var(--success);
            box-shadow: 0 3px 10px rgba(46, 204, 113, 0.5);
        }
        
        .dropoff-marker {
            background: var(--primary);
            box-shadow: 0 3px 10px rgba(255, 107, 53, 0.5);
        }
        
        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--dark);
            color: white;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 14px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1100;
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Toast tr√™n mobile - ·∫©n khi c√≥ menu */
        @media (max-width: 900px) {
            .toast {
                display: none;
            }
        }
        
        /* Autocomplete Dropdown */
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            margin-top: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .autocomplete-dropdown.show {
            display: block;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 1px solid #F0F0F0;
            transition: background 0.2s;
            line-height: 1.5;
            color: #333;
        }

        .autocomplete-item strong {
            font-weight: 600;
            color: var(--primary);
        }

        .autocomplete-item:hover {
            background: #F5F5F5;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        .input-wrapper {
            position: relative;
        }

        .drag-hint {
            font-size: 11px;
            color: var(--warning);
            margin-top: 6px;
            opacity: 0.9;
        }

        .phone-error {
            font-size: 12px;
            color: #FF6B35;
            margin-top: 6px;
            font-weight: 500;
            display: none;
        }

        .phone-error.show {
            display: block;
        }

        .form-input.error {
            border-color: #FF6B35;
            background: rgba(255, 107, 53, 0.05);
        }

        /* GPS Confirm Modal */
        .gps-confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .gps-confirm-overlay.show {
            display: flex;
        }

        .gps-confirm-content {
            background: linear-gradient(180deg, #1E1E32 0%, #16162A 100%);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 380px;
            width: 90%;
            border: 1px solid rgba(255,255,255,0.1);
            animation: scaleIn 0.3s ease;
        }

        .gps-confirm-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #2ECC71, #27AE60);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .gps-confirm-icon svg {
            width: 35px;
            height: 35px;
            fill: white;
        }

        .gps-confirm-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: white;
        }

        .gps-confirm-text {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .gps-confirm-buttons {
            display: flex;
            gap: 12px;
        }

        .gps-confirm-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .gps-confirm-btn.yes {
            background: linear-gradient(135deg, #FF6B35 0%, #E55A2B 100%);
            color: white;
        }

        .gps-confirm-btn.yes:hover {
            background: linear-gradient(135deg, #E55A2B 0%, #CC4A20 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        .gps-confirm-btn.no {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .gps-confirm-btn.no:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }

        .gps-loading {
            display: none;
            margin-top: 16px;
            color: #2ECC71;
            font-size: 13px;
        }

        .gps-loading.show {
            display: block;
        }
        
        /* Note */
        .note-text {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            text-align: center;
            margin-top: 16px;
            line-height: 1.5;
        }

        /* Hi·ªáu ·ª©ng ki·∫øn b√≤ cho ƒë∆∞·ªùng d·∫´n */
        @keyframes dash {
            to {
                stroke-dashoffset: -50;
            }
        }

        .route-animation {
            animation: dash 1.5s linear infinite;
        }

        /* Context Menu cho map */
        .map-context-menu {
            position: fixed;
            background: #1E1E32;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 8px;
            z-index: 2500;
            display: none;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            min-width: 200px;
        }

        .map-context-menu.show {
            display: block;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .context-menu-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .context-menu-item.pickup {
            color: var(--success);
        }

        .context-menu-item.dropoff {
            color: var(--primary);
        }

        .context-menu-item svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <!-- Header Hotline - Click ƒë·ªÉ g·ªçi ngay -->
    <header class="header">
        <a href="tel:0777131355" class="hotline-link" title="Nh·∫•n ƒë·ªÉ g·ªçi ngay!">
            <div class="hotline-container">
                <div class="hotline-phone-section">
                    <div class="hotline-icon">
                        <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                    </div>
                    <div class="hotline-text">
                        <span class="hotline-label">HOTLINE</span>
                        <span class="hotline-number">0777.13.13.55</span>
                    </div>
                </div>
                <div class="call-badge">·∫§N ƒê·ªÇ<br>G·ªåI NGAY</div>
            </div>
        </a>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Map -->
        <div class="map-container">
            <div id="map"></div>
        </div>

        <!-- Sidebar Form -->
        <aside class="sidebar" id="bookingPanel">
            <!-- Handle ƒë·ªÉ k√©o -->
            <div class="panel-handle"></div>

            <!-- Summary - Hi·ªán khi thu g·ªçn -->
            <div class="form-summary" id="formSummary">
                <div class="summary-row">
                    <span class="summary-label">üìç ƒêi·ªÉm ƒë√≥n:</span>
                    <span class="summary-value" id="summaryPickup">--</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">üìç ƒêi·ªÉm ƒë·∫øn:</span>
                    <span class="summary-value" id="summaryDropoff">--</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">üìû SƒêT:</span>
                    <span class="summary-value" id="summaryPhone">--</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">üí∞ Gi√°:</span>
                    <span class="summary-price" id="summaryPrice">--</span>
                </div>
                <button type="button" class="submit-btn" id="summaryBookBtn" style="margin-top: 12px;">
                    ƒê·∫∂T L√ÅI XE NGAY
                </button>
            </div>

            <!-- Form Details - Hi·ªán khi m·ªü r·ªông -->
            <div class="form-details">
                <div class="logo-section">
                    <div class="brand-name">LaiXeHoHaTinh.com</div>
                    <div class="slogan">B·∫°n Qu√° Say - T√¥i ƒê∆∞a B·∫°n Quay V·ªÅ</div>
                    <h1>üöó L√ÅI XE H·ªò H√Ä Tƒ®NH</h1>
                    <div class="tagline">An to√†n - Nhanh ch√≥ng - Uy t√≠n - T·∫≠n T√¢m</div>
                </div>

            <form id="bookingForm">
                <!-- ƒêi·ªÉm ƒë√≥n -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="icon pickup">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8"/></svg>
                        </span>
                        ƒêi·ªÉm ƒë√≥n
                    </label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" id="pickupInput" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ƒëi·ªÉm ƒë√≥n..." autocomplete="off" required>
                        <div class="autocomplete-dropdown" id="pickupDropdown"></div>
                    </div>
                    <button type="button" class="use-location-btn" onclick="useCurrentLocation('pickup')">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
                        D√πng v·ªã tr√≠ hi·ªán t·∫°i
                    </button>
                </div>

                <!-- ƒêi·ªÉm ƒë·∫øn -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="icon dropoff">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                        </span>
                        ƒêi·ªÉm ƒë·∫øn
                    </label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" id="dropoffInput" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ƒëi·ªÉm ƒë·∫øn (kh√¥ng b·∫Øt bu·ªôc)..." autocomplete="off">
                        <div class="autocomplete-dropdown" id="dropoffDropdown"></div>
                    </div>
                    <p class="drag-hint">üí° ƒê·ªãa ch·ªâ ch∆∞a ƒë√∫ng? K√©o ghim üìç tr√™n b·∫£n ƒë·ªì ƒë·ªÉ ch·ªânh!</p>
                </div>

                <div class="divider"></div>

                <!-- S·ªë ƒëi·ªán tho·∫°i -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="icon phone">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                        </span>
                        S·ªë ƒëi·ªán tho·∫°i
                    </label>
                    <input type="tel" class="form-input" id="phoneInput" placeholder="Qu√Ω kh√°ch vui l√≤ng ƒëi·ªÅn ƒë√∫ng s·ªë ƒëi·ªán tho·∫°i" pattern="[0-9]{10,11}" required>
                    <div class="phone-error" id="phoneError"></div>
                </div>

                <!-- Price Display -->
                <div class="price-display" id="priceDisplay">
                    <div class="price-row">
                        <span class="price-label">Kho·∫£ng c√°ch</span>
                        <span class="price-value" id="distanceValue">-- km</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label">3km ƒë·∫ßu</span>
                        <span class="price-value" id="first3kmPrice">--</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label">Km th√™m (<span id="extraKm">0</span> km √ó 15.000ƒë)</span>
                        <span class="price-value" id="extraKmPrice">--</span>
                    </div>
                    <div class="price-row total">
                        <span class="price-label">T·ªïng ti·ªÅn</span>
                        <span class="price-value" id="totalPrice">--</span>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">ƒê·∫∂T L√ÅI XE NGAY</span>
                </button>

                <p class="note-text">
                    ƒê·∫∑t xe xong, t√†i x·∫ø s·∫Ω g·ªçi l·∫°i trong 5 ph√∫t.<br>
                    Gi√° c√≥ th·ªÉ thay ƒë·ªïi t√πy tuy·∫øn ƒë∆∞·ªùng th·ª±c t·∫ø.
                </p>
            </form>
            </div>
        </aside>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <div class="modal-icon">
                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
            </div>
            <h2 class="modal-title">ƒê·∫∑t xe th√†nh c√¥ng!</h2>
            <p class="modal-text">C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•. T√†i x·∫ø s·∫Ω li√™n h·ªá v·ªõi b·∫°n trong v√†i ph√∫t.</p>
            <div class="modal-order-id" id="orderId">M√£ ƒë∆°n: #LXH-000000</div>
            <button class="modal-close-btn" onclick="closeModal()">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- GPS Confirm Modal -->
    <div class="gps-confirm-overlay" id="gpsConfirmModal">
        <div class="gps-confirm-content">
            <div class="gps-confirm-icon">
                <svg viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
            </div>
            <h2 class="gps-confirm-title">üìç B·∫≠t GPS ƒë·ªÉ ƒë·∫∑t xe nhanh h∆°n!</h2>
            <p class="gps-confirm-text">
                <strong>‚úÖ B·∫≠t GPS:</strong> T·ª± ƒë·ªông l·∫•y ƒëi·ªÉm ƒë√≥n, ch·ªâ c·∫ßn nh·∫≠p ƒëi·ªÉm ƒë·∫øn (ho·∫∑c kh√¥ng c·∫ßn)<br>
                <strong>‚ùå Kh√¥ng b·∫≠t:</strong> Ph·∫£i t·ª± nh·∫≠p ƒë·ªãa ch·ªâ ƒëi·ªÉm ƒë√≥n
            </p>
            <div class="gps-confirm-buttons">
                <button class="gps-confirm-btn no" onclick="declineGPS()">Kh√¥ng</button>
                <button class="gps-confirm-btn yes" onclick="acceptGPS()">C√≥, ƒë√≥n t·∫°i ƒë√¢y</button>
            </div>
            <div class="gps-loading" id="gpsLoading">
                <span class="spinner"></span> ƒêang l·∫•y v·ªã tr√≠...
            </div>
        </div>
    </div>

    <!-- Context Menu cho Map -->
    <div class="map-context-menu" id="mapContextMenu">
        <div class="context-menu-item pickup" onclick="setPointFromMenu('pickup')">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg>
            <span>ƒê·∫∑t l√†m ƒëi·ªÉm ƒë√≥n</span>
        </div>
        <div class="context-menu-item dropoff" onclick="setPointFromMenu('dropoff')">
            <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            <span>ƒê·∫∑t l√†m ƒëi·ªÉm ƒë·∫øn</span>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // =============================================
        // C·∫§U H√åNH - THAY ƒê·ªîI TH√îNG TIN T·∫†I ƒê√ÇY
        // =============================================
        const CONFIG = {
            // Webhook URL ƒë·ªÉ nh·∫≠n ƒë∆°n h√†ng
            // Thay b·∫±ng URL Railway c·ªßa b·∫°n sau khi deploy
            WEBHOOK_URL: 'https://laixehohatinh-server.up.railway.app/api/orders',
            
            // S·ªë hotline
            HOTLINE: '0777.13.13.55',
            
            // Gi√° 3km ƒë·∫ßu (VNƒê) - T·ªëi thi·ªÉu
            FIRST_3KM_PRICE: 80000,

            // Gi√° m·ªói km t·ª´ km th·ª© 4 tr·ªü ƒëi (VNƒê)
            PRICE_PER_KM_AFTER_3: 15000,
            
            // T·ªça ƒë·ªô trung t√¢m H√† Tƒ©nh
            CENTER_LAT: 18.3559,
            CENTER_LNG: 105.8877,
            
            // Zoom m·∫∑c ƒë·ªãnh
            DEFAULT_ZOOM: 12
        };

        // =============================================
        // KH·ªûI T·∫†O B·∫¢N ƒê·ªí
        // =============================================
        const map = L.map('map').setView([CONFIG.CENTER_LAT, CONFIG.CENTER_LNG], CONFIG.DEFAULT_ZOOM);
        
        // Th√™m tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Markers
        let pickupMarker = null;
        let dropoffMarker = null;
        let routeLine = null;

        // T·∫°o custom icon
        const createIcon = (color) => L.divIcon({
            className: 'custom-div-icon',
            html: `<div style="
                width: 24px;
                height: 24px;
                background: ${color};
                border-radius: 50% 50% 50% 0;
                transform: rotate(-45deg);
                border: 3px solid white;
                box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            "></div>`,
            iconSize: [24, 24],
            iconAnchor: [12, 24]
        });

        const pickupIcon = createIcon('#2ECC71');
        const dropoffIcon = createIcon('#FF6B35');

        // =============================================
        // GEOCODING & AUTOCOMPLETE
        // =============================================
        let searchTimeout = null;

        // Helper function ƒë·ªÉ l·∫•y icon ph√π h·ª£p
        function getIconForType(classType, type) {
            const iconMap = {
                'restaurant': 'üçΩÔ∏è',
                'cafe': '‚òï',
                'bar': 'üç∫',
                'pub': 'üçª',
                'hotel': 'üè®',
                'hospital': 'üè•',
                'school': 'üè´',
                'bank': 'üè¶',
                'atm': 'üèß',
                'pharmacy': 'üíä',
                'fuel': '‚õΩ',
                'parking': 'üÖøÔ∏è',
                'supermarket': 'üõí',
                'shop': 'üè™',
                'mall': 'üè¨',
                'office': 'üè¢',
                'building': 'üè¢',
                'university': 'üéì',
                'church': '‚õ™',
                'temple': 'üõï',
                'airport': '‚úàÔ∏è',
                'bus_station': 'üöå',
                'police': 'üëÆ',
                'default': 'üìç'
            };
            return iconMap[classType] || iconMap[type] || iconMap['default'];
        }

        async function searchLocation(query) {
            try {
                // T√¨m ki·∫øm ƒë·ªãa ch·ªâ c·ª• th·ªÉ h∆°n v·ªõi addressdetails
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?` +
                    `format=json` +
                    `&q=${encodeURIComponent(query + ', H√† Tƒ©nh, Vietnam')}` +
                    `&limit=10` + // TƒÉng s·ªë k·∫øt qu·∫£
                    `&addressdetails=1` + // L·∫•y chi ti·∫øt ƒë·ªãa ch·ªâ
                    `&extratags=1` + // L·∫•y th√¥ng tin b·ªï sung (t√™n qu√°n, c·ª≠a h√†ng...)
                    `&namedetails=1` // L·∫•y t√™n chi ti·∫øt
                );
                const results = await response.json();

                // S·∫Øp x·∫øp ∆∞u ti√™n: ƒë·ªãa ch·ªâ c·ª• th·ªÉ tr∆∞·ªõc, ƒë·ªãa danh l·ªõn sau
                return results.sort((a, b) => {
                    // ∆Øu ti√™n c√≥ s·ªë nh√†
                    const aHasNumber = a.address?.house_number ? 1 : 0;
                    const bHasNumber = b.address?.house_number ? 1 : 0;
                    if (aHasNumber !== bHasNumber) return bHasNumber - aHasNumber;

                    // ∆Øu ti√™n POI (qu√°n, c·ª≠a h√†ng, ƒëi·ªÉm ƒë·∫øn c·ª• th·ªÉ)
                    const poiTypes = ['amenity', 'shop', 'tourism', 'building', 'office'];
                    const aIsPOI = poiTypes.includes(a.type) ? 1 : 0;
                    const bIsPOI = poiTypes.includes(b.type) ? 1 : 0;
                    if (aIsPOI !== bIsPOI) return bIsPOI - aIsPOI;

                    // ∆Øu ti√™n importance cao h∆°n
                    return (b.importance || 0) - (a.importance || 0);
                });
            } catch (error) {
                console.error('Search error:', error);
                return [];
            }
        }

        function setupAutocomplete(inputId, dropdownId, type) {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);

            input.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                const query = input.value.trim();
                
                if (query.length < 2) {
                    dropdown.classList.remove('show');
                    return;
                }

                searchTimeout = setTimeout(async () => {
                    const results = await searchLocation(query);

                    if (results.length > 0) {
                        dropdown.innerHTML = results.map(r => {
                            // Format ƒë·ªãa ch·ªâ ƒë·∫πp h∆°n
                            let displayText = '';
                            let icon = 'üìç';

                            // Ki·ªÉm tra lo·∫°i ƒë·ªãa ƒëi·ªÉm
                            if (r.type === 'amenity' || r.type === 'shop' || r.type === 'tourism') {
                                // Qu√°n caf√©, nh√† h√†ng, c·ª≠a h√†ng
                                icon = getIconForType(r.class, r.type);
                                const name = r.namedetails?.name || r.name || '';
                                const road = r.address?.road || '';
                                const suburb = r.address?.suburb || r.address?.neighbourhood || '';
                                displayText = `${icon} <strong>${name}</strong>${road ? ', ' + road : ''}${suburb ? ', ' + suburb : ''}`;
                            } else if (r.address?.house_number && r.address?.road) {
                                // C√≥ s·ªë nh√† - ƒë·ªãa ch·ªâ c·ª• th·ªÉ
                                icon = 'üè†';
                                const number = r.address.house_number;
                                const road = r.address.road;
                                const suburb = r.address?.suburb || r.address?.neighbourhood || '';
                                displayText = `${icon} <strong>${number} ${road}</strong>${suburb ? ', ' + suburb : ''}`;
                            } else if (r.address?.road) {
                                // Ch·ªâ c√≥ ƒë∆∞·ªùng
                                icon = 'üõ£Ô∏è';
                                const road = r.address.road;
                                const suburb = r.address?.suburb || r.address?.neighbourhood || '';
                                displayText = `${icon} ${road}${suburb ? ', ' + suburb : ''}`;
                            } else {
                                // ƒê·ªãa danh chung
                                displayText = `üìç ${r.display_name}`;
                            }

                            return `
                                <div class="autocomplete-item" data-lat="${r.lat}" data-lng="${r.lon}" data-name="${r.display_name}">
                                    ${displayText}
                                </div>
                            `;
                        }).join('');
                        dropdown.classList.add('show');

                        dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                            item.addEventListener('click', () => {
                                const lat = parseFloat(item.dataset.lat);
                                const lng = parseFloat(item.dataset.lng);
                                const name = item.dataset.name;
                                
                                input.value = name;
                                input.dataset.lat = lat;
                                input.dataset.lng = lng;
                                dropdown.classList.remove('show');
                                
                                setMarker(type, lat, lng);
                                updateRoute();
                            });
                        });
                    } else {
                        dropdown.classList.remove('show');
                    }
                }, 300);
            });

            // ƒê√≥ng dropdown khi click ra ngo√†i
            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });
        }

        // Kh·ªüi t·∫°o autocomplete
        setupAutocomplete('pickupInput', 'pickupDropdown', 'pickup');
        setupAutocomplete('dropoffInput', 'dropoffDropdown', 'dropoff');

        // =============================================
        // PHONE VALIDATION
        // =============================================
        const phoneInput = document.getElementById('phoneInput');
        const phoneError = document.getElementById('phoneError');

        phoneInput.addEventListener('input', (e) => {
            // Ch·ªâ cho ph√©p nh·∫≠p s·ªë
            e.target.value = e.target.value.replace(/[^0-9]/g, '');

            const phone = e.target.value;
            const length = phone.length;

            // X√≥a error khi ƒëang g√µ
            if (length === 0) {
                phoneInput.classList.remove('error');
                phoneError.classList.remove('show');
                phoneError.textContent = '';
                return;
            }

            // Ki·ªÉm tra s·ªë l∆∞·ª£ng ch·ªØ s·ªë
            if (length < 10) {
                phoneInput.classList.add('error');
                phoneError.classList.add('show');
                phoneError.textContent = `‚ö†Ô∏è Qu√Ω kh√°ch vui l√≤ng ki·ªÉm tra l·∫°i s·ªë, ƒëang thi·∫øu ${10 - length} s·ªë`;
            } else if (length > 11) {
                phoneInput.classList.add('error');
                phoneError.classList.add('show');
                phoneError.textContent = `‚ö†Ô∏è Qu√Ω kh√°ch vui l√≤ng ki·ªÉm tra l·∫°i s·ªë, ƒëang th·ª´a ${length - 11} s·ªë`;
            } else {
                // ƒê√∫ng 10 ho·∫∑c 11 s·ªë
                phoneInput.classList.remove('error');
                phoneError.classList.remove('show');
                phoneError.textContent = '';
            }
        });

        phoneInput.addEventListener('blur', () => {
            const phone = phoneInput.value;
            if (phone.length > 0 && (phone.length < 10 || phone.length > 11)) {
                phoneInput.classList.add('error');
                phoneError.classList.add('show');
            }
        });

        // =============================================
        // MAP FUNCTIONS
        // =============================================
        function setMarker(type, lat, lng) {
            if (type === 'pickup') {
                if (pickupMarker) map.removeLayer(pickupMarker);
                pickupMarker = L.marker([lat, lng], { 
                    icon: pickupIcon,
                    draggable: true  // Cho ph√©p k√©o th·∫£
                }).addTo(map);
                
                // X·ª≠ l√Ω khi k√©o th·∫£ xong
                pickupMarker.on('dragend', async function(e) {
                    const pos = e.target.getLatLng();
                    await updateAddressFromMarker('pickup', pos.lat, pos.lng);
                    updateRoute();
                });
            } else {
                if (dropoffMarker) map.removeLayer(dropoffMarker);
                dropoffMarker = L.marker([lat, lng], { 
                    icon: dropoffIcon,
                    draggable: true  // Cho ph√©p k√©o th·∫£
                }).addTo(map);
                
                // X·ª≠ l√Ω khi k√©o th·∫£ xong
                dropoffMarker.on('dragend', async function(e) {
                    const pos = e.target.getLatLng();
                    await updateAddressFromMarker('dropoff', pos.lat, pos.lng);
                    updateRoute();
                });
            }
            
            // Fit bounds n·∫øu c√≥ c·∫£ 2 markers
            if (pickupMarker && dropoffMarker) {
                const group = L.featureGroup([pickupMarker, dropoffMarker]);
                map.fitBounds(group.getBounds().pad(0.2));
            } else {
                map.setView([lat, lng], 14);
            }
        }
        
        // H√†m c·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ khi k√©o marker
        async function updateAddressFromMarker(type, lat, lng) {
            const input = document.getElementById(type + 'Input');
            input.dataset.lat = lat;
            input.dataset.lng = lng;
            
            showToast('ƒêang c·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ...');
            
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`
                );
                const data = await response.json();
                input.value = data.display_name || `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                showToast(`ƒê√£ c·∫≠p nh·∫≠t ${type === 'pickup' ? 'ƒëi·ªÉm ƒë√≥n' : 'ƒëi·ªÉm ƒë·∫øn'}!`);
            } catch (error) {
                input.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                console.error('Reverse geocoding error:', error);
            }
        }

        async function updateRoute() {
            const pickupInput = document.getElementById('pickupInput');
            const dropoffInput = document.getElementById('dropoffInput');

            // Ch·ªâ c·∫ßn ƒëi·ªÉm ƒë√≥n, ƒëi·ªÉm ƒë·∫øn kh√¥ng b·∫Øt bu·ªôc
            if (!pickupInput.dataset.lat) return;
            if (!dropoffInput.dataset.lat) return; // N·∫øu kh√¥ng c√≥ ƒëi·ªÉm ƒë·∫øn th√¨ kh√¥ng v·∫Ω route

            const pickup = [parseFloat(pickupInput.dataset.lat), parseFloat(pickupInput.dataset.lng)];
            const dropoff = [parseFloat(dropoffInput.dataset.lat), parseFloat(dropoffInput.dataset.lng)];

            // X√≥a route c≈©
            if (routeLine) map.removeLayer(routeLine);

            // G·ªçi OSRM API ƒë·ªÉ l·∫•y tuy·∫øn ƒë∆∞·ªùng th·ª±c t·∫ø
            try {
                showToast('ƒêang t√≠nh tuy·∫øn ƒë∆∞·ªùng...');

                const response = await fetch(
                    `https://router.project-osrm.org/route/v1/driving/${pickup[1]},${pickup[0]};${dropoff[1]},${dropoff[0]}?overview=full&geometries=geojson`
                );
                const data = await response.json();

                if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    const coordinates = route.geometry.coordinates.map(coord => [coord[1], coord[0]]);

                    // V·∫Ω ƒë∆∞·ªùng ƒëi th·ª±c t·∫ø
                    routeLine = L.polyline(coordinates, {
                        color: '#0066FF',
                        weight: 6,
                        opacity: 0.8,
                        lineJoin: 'round',
                        dashArray: '10, 15',
                        className: 'route-animation'
                    }).addTo(map);

                    // L·∫•y kho·∫£ng c√°ch th·ª±c t·∫ø t·ª´ OSRM (ƒë∆°n v·ªã: m√©t)
                    const distanceKm = route.distance / 1000;
                    updatePrice(distanceKm);

                    showToast(`Tuy·∫øn ƒë∆∞·ªùng: ${distanceKm.toFixed(1)} km`);
                } else {
                    // Fallback: v·∫Ω ƒë∆∞·ªùng th·∫≥ng n·∫øu OSRM th·∫•t b·∫°i
                    throw new Error('OSRM routing failed');
                }
            } catch (error) {
                console.error('Routing error:', error);

                // V·∫Ω ƒë∆∞·ªùng th·∫≥ng backup
                routeLine = L.polyline([pickup, dropoff], {
                    color: '#0066FF',
                    weight: 6,
                    opacity: 0.8,
                    dashArray: '10, 15',
                    className: 'route-animation'
                }).addTo(map);

                // T√≠nh kho·∫£ng c√°ch ƒë∆∞·ªùng chim bay * 1.3 ∆∞·ªõc t√≠nh
                const distance = calculateDistance(pickup[0], pickup[1], dropoff[0], dropoff[1]) * 1.3;
                updatePrice(distance);

                showToast('T√≠nh theo ∆∞·ªõc l∆∞·ª£ng (kh√¥ng t√¨m ƒë∆∞·ª£c ƒë∆∞·ªùng)');
            }
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updatePrice(distanceKm) {
            const priceDisplay = document.getElementById('priceDisplay');
            const distanceValue = document.getElementById('distanceValue');
            const first3kmPrice = document.getElementById('first3kmPrice');
            const extraKm = document.getElementById('extraKm');
            const extraKmPrice = document.getElementById('extraKmPrice');
            const totalPrice = document.getElementById('totalPrice');

            const distance = Math.round(distanceKm * 10) / 10;

            let price = 0;
            let firstPart = 0;
            let extraPart = 0;
            let extraDistance = 0;

            if (distance <= 3) {
                // D∆∞·ªõi 3km: ch·ªâ t√≠nh gi√° c·ªë ƒë·ªãnh 70k
                price = CONFIG.FIRST_3KM_PRICE;
                firstPart = CONFIG.FIRST_3KM_PRICE;
                extraPart = 0;
                extraDistance = 0;
            } else {
                // Tr√™n 3km: 70k cho 3km ƒë·∫ßu + 15k/km cho ph·∫ßn c√≤n l·∫°i
                firstPart = CONFIG.FIRST_3KM_PRICE;
                extraDistance = Math.round((distance - 3) * 10) / 10;
                extraPart = Math.ceil(extraDistance * CONFIG.PRICE_PER_KM_AFTER_3 / 1000) * 1000;
                price = firstPart + extraPart;
            }

            distanceValue.textContent = `${distance} km`;
            first3kmPrice.textContent = formatCurrency(firstPart);
            extraKm.textContent = extraDistance.toFixed(1);
            extraKmPrice.textContent = extraPart > 0 ? formatCurrency(extraPart) : '0ƒë';
            totalPrice.textContent = formatCurrency(price);
            priceDisplay.classList.add('show');

            // L∆∞u gi√° v√†o form
            document.getElementById('bookingForm').dataset.price = price;
            document.getElementById('bookingForm').dataset.distance = distance;

            // C·∫≠p nh·∫≠t summary n·∫øu tr√™n mobile
            if (window.innerWidth <= 900 && typeof updateSummary === 'function') {
                updateSummary();
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount) + 'ƒë';
        }

        // =============================================
        // V·ªä TR√ç HI·ªÜN T·∫†I
        // =============================================
        function useCurrentLocation(type) {
            if (!navigator.geolocation) {
                showToast('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã');
                return;
            }

            showToast('ƒêang l·∫•y v·ªã tr√≠...');
            
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const { latitude, longitude } = position.coords;
                    
                    // Reverse geocoding
                    try {
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`
                        );
                        const data = await response.json();
                        
                        const input = document.getElementById(type + 'Input');
                        input.value = data.display_name || `${latitude}, ${longitude}`;
                        input.dataset.lat = latitude;
                        input.dataset.lng = longitude;
                        
                        setMarker(type, latitude, longitude);
                        updateRoute();
                        showToast('ƒê√£ l·∫•y v·ªã tr√≠ th√†nh c√¥ng!');
                    } catch (error) {
                        console.error('Reverse geocoding error:', error);
                        showToast('Kh√¥ng th·ªÉ l·∫•y ƒë·ªãa ch·ªâ');
                    }
                },
                (error) => {
                    console.error('Geolocation error:', error);
                    showToast('Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠. Vui l√≤ng cho ph√©p truy c·∫≠p v·ªã tr√≠.');
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }

        // =============================================
        // G·ª¨I ƒê∆†N H√ÄNG
        // =============================================
        // MOBILE: PANEL COLLAPSE/EXPAND
        // =============================================

        const bookingPanel = document.getElementById('bookingPanel');
        const mapContainer = document.getElementById('map');
        const formSummary = document.getElementById('formSummary');

        // Function ƒë·ªÉ c·∫≠p nh·∫≠t summary
        function updateSummary() {
            const pickupInput = document.getElementById('pickupInput');
            const dropoffInput = document.getElementById('dropoffInput');
            const phoneInput = document.getElementById('phoneInput');
            const form = document.getElementById('bookingForm');

            document.getElementById('summaryPickup').textContent = pickupInput.value || '--';
            document.getElementById('summaryDropoff').textContent = dropoffInput.value || '--';
            document.getElementById('summaryPhone').textContent = phoneInput.value || '--';

            const price = parseInt(form.dataset.price);
            if (price) {
                document.getElementById('summaryPrice').textContent = price.toLocaleString('vi-VN') + 'ƒë';
            } else {
                document.getElementById('summaryPrice').textContent = '--';
            }
        }

        // Thu g·ªçn panel khi click v√†o map (ch·ªâ mobile)
        if (window.innerWidth <= 900) {
            mapContainer.addEventListener('click', (e) => {
                // Kh√¥ng collapse n·∫øu click v√†o context menu
                if (e.target.closest('.map-context-menu')) return;

                bookingPanel.classList.add('collapsed');
                updateSummary();
            });

            // M·ªü r·ªông panel khi click v√†o panel ho·∫∑c handle
            bookingPanel.addEventListener('click', () => {
                bookingPanel.classList.remove('collapsed');
            });

            // N√∫t ƒë·∫∑t xe trong summary
            document.getElementById('summaryBookBtn').addEventListener('click', () => {
                // Trigger form submit
                document.getElementById('bookingForm').dispatchEvent(new Event('submit', { cancelable: true }));
            });

            // C·∫≠p nh·∫≠t summary khi c√≥ thay ƒë·ªïi
            ['pickupInput', 'dropoffInput', 'phoneInput'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateSummary);
                document.getElementById(id).addEventListener('change', updateSummary);
            });
        }

        // =============================================
        // FORM SUBMIT
        // =============================================
        document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const pickupInput = document.getElementById('pickupInput');
            const dropoffInput = document.getElementById('dropoffInput');
            const phoneInput = document.getElementById('phoneInput');
            const form = document.getElementById('bookingForm');
            
            // Validate - Ch·ªâ c·∫ßn ƒëi·ªÉm ƒë√≥n, ƒëi·ªÉm ƒë·∫øn kh√¥ng b·∫Øt bu·ªôc
            if (!pickupInput.dataset.lat) {
                showToast('Vui l√≤ng ch·ªçn ƒëi·ªÉm ƒë√≥n');
                return;
            }

            if (!phoneInput.value.match(/^[0-9]{10,11}$/)) {
                showToast('S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá');
                return;
            }

            // Disable button
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            submitBtn.disabled = true;
            btnText.innerHTML = '<span class="spinner"></span>ƒêang x·ª≠ l√Ω...';

            // T·∫°o order data
            const orderId = 'LXH-' + Date.now().toString().slice(-6);
            const orderData = {
                orderId: orderId,
                timestamp: new Date().toISOString(),
                customer: {
                    phone: phoneInput.value
                },
                pickup: {
                    address: pickupInput.value,
                    lat: parseFloat(pickupInput.dataset.lat),
                    lng: parseFloat(pickupInput.dataset.lng)
                },
                dropoff: dropoffInput.dataset.lat ? {
                    address: dropoffInput.value,
                    lat: parseFloat(dropoffInput.dataset.lat),
                    lng: parseFloat(dropoffInput.dataset.lng)
                } : null,
                distance: parseFloat(form.dataset.distance) || 0,
                price: parseInt(form.dataset.price) || CONFIG.MIN_PRICE,
                status: 'pending'
            };

            try {
                // G·ª≠i ƒë·∫øn webhook/server
                const response = await fetch(CONFIG.WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });

                // Hi·ªán modal th√†nh c√¥ng (d√π webhook c√≥ l·ªói c≈©ng hi·ªán ƒë·ªÉ demo)
                showSuccessModal(orderId);
                
                // Log order (ƒë·ªÉ debug)
                console.log('Order sent:', orderData);
                
            } catch (error) {
                console.error('Error sending order:', error);
                // V·∫´n hi·ªán modal th√†nh c√¥ng ƒë·ªÉ demo
                showSuccessModal(orderId);
                console.log('Order data (webhook failed):', orderData);
            }

            // Reset button
            submitBtn.disabled = false;
            btnText.textContent = 'ƒê·∫∂T L√ÅI XE NGAY';
        });

        // =============================================
        // MODAL & TOAST
        // =============================================
        function showSuccessModal(orderId) {
            document.getElementById('orderId').textContent = 'M√£ ƒë∆°n: #' + orderId;
            document.getElementById('successModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('successModal').classList.remove('show');
            // Reset form
            document.getElementById('bookingForm').reset();
            document.getElementById('priceDisplay').classList.remove('show');
            document.getElementById('pickupInput').dataset.lat = '';
            document.getElementById('dropoffInput').dataset.lat = '';
            if (pickupMarker) map.removeLayer(pickupMarker);
            if (dropoffMarker) map.removeLayer(dropoffMarker);
            if (routeLine) map.removeLayer(routeLine);
            pickupMarker = null;
            dropoffMarker = null;
            routeLine = null;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // =============================================
        // CONTEXT MENU - CHU·ªòT PH·∫¢I / LONG PRESS
        // =============================================
        let longPressTimer = null;
        let longPressLat = null;
        let longPressLng = null;
        let touchStartX = null;
        let touchStartY = null;
        const contextMenu = document.getElementById('mapContextMenu');

        // DESKTOP: Chu·ªôt ph·∫£i ƒë·ªÉ hi·ªán menu
        map.on('contextmenu', (e) => {
            e.originalEvent.preventDefault();

            // ƒê√≥ng menu c≈© n·∫øu c√≥
            if (contextMenu.classList.contains('show')) {
                hideContextMenu();
                return;
            }

            longPressLat = e.latlng.lat;
            longPressLng = e.latlng.lng;
            showContextMenu(e.originalEvent.clientX, e.originalEvent.clientY);
        });

        // MOBILE: Long press (gi·ªØ 0.5s)
        let touchMoved = false;

        map.on('touchstart', (e) => {
            if (e.originalEvent.touches.length === 1) {
                touchMoved = false;
                const touch = e.originalEvent.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;

                longPressLat = e.latlng.lat;
                longPressLng = e.latlng.lng;

                longPressTimer = setTimeout(() => {
                    if (!touchMoved) {
                        showContextMenu(touch.clientX, touch.clientY);
                    }
                }, 500); // 0.5 gi√¢y cho mobile
            }
        });

        map.on('touchmove', (e) => {
            if (longPressTimer && e.originalEvent.touches.length === 1) {
                const touch = e.originalEvent.touches[0];
                const moveX = Math.abs(touch.clientX - touchStartX);
                const moveY = Math.abs(touch.clientY - touchStartY);

                // N·∫øu di chuy·ªÉn qu√° 10px th√¨ h·ªßy
                if (moveX > 10 || moveY > 10) {
                    touchMoved = true;
                    clearTimeout(longPressTimer);
                }
            }
        });

        map.on('touchend', () => {
            clearTimeout(longPressTimer);
        });

        function showContextMenu(x, y) {
            // Hi·ªán menu tr∆∞·ªõc ƒë·ªÉ l·∫•y k√≠ch th∆∞·ªõc
            contextMenu.classList.add('show');

            // L·∫•y k√≠ch th∆∞·ªõc menu
            const menuWidth = contextMenu.offsetWidth;
            const menuHeight = contextMenu.offsetHeight;

            // T√≠nh v·ªã tr√≠: cƒÉn gi·ªØa theo chi·ªÅu ngang, ph√≠a tr√™n ƒëi·ªÉm ch·∫°m
            let left = x - (menuWidth / 2);
            let top = y - menuHeight - 20; // 20px ph√≠a tr√™n ƒëi·ªÉm ch·∫°m

            // ƒê·∫£m b·∫£o kh√¥ng b·ªã tr√†n m√†n h√¨nh
            const padding = 10;
            if (left < padding) left = padding;
            if (left + menuWidth > window.innerWidth - padding) {
                left = window.innerWidth - menuWidth - padding;
            }
            if (top < padding) {
                // N·∫øu kh√¥ng ƒë·ªß ch·ªó ph√≠a tr√™n, hi·ªán ph√≠a d∆∞·ªõi
                top = y + 20;
            }

            contextMenu.style.left = left + 'px';
            contextMenu.style.top = top + 'px';

            // Kh√¥ng hi·ªán toast tr√™n mobile
            if (window.innerWidth > 900) {
                showToast('üìç Ch·ªçn lo·∫°i ƒëi·ªÉm b·∫°n mu·ªën ƒë·∫∑t');
            }
        }

        function hideContextMenu() {
            contextMenu.classList.remove('show');
        }

        // ƒê√≥ng menu khi click ra ngo√†i
        document.addEventListener('click', (e) => {
            if (!contextMenu.contains(e.target) && contextMenu.classList.contains('show')) {
                hideContextMenu();
            }
        });

        // X·ª≠ l√Ω khi ch·ªçn lo·∫°i ƒëi·ªÉm t·ª´ menu
        async function setPointFromMenu(type) {
            hideContextMenu();

            if (!longPressLat || !longPressLng) return;

            showToast(`ƒêang ƒë·∫∑t ${type === 'pickup' ? 'ƒëi·ªÉm ƒë√≥n' : 'ƒëi·ªÉm ƒë·∫øn'}...`);

            // Reverse geocoding
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${longPressLat}&lon=${longPressLng}`
                );
                const data = await response.json();

                const input = document.getElementById(type + 'Input');
                input.value = data.display_name || `${longPressLat.toFixed(6)}, ${longPressLng.toFixed(6)}`;
                input.dataset.lat = longPressLat;
                input.dataset.lng = longPressLng;

                setMarker(type, longPressLat, longPressLng);
                updateRoute();

                showToast(`‚úÖ ƒê√£ ƒë·∫∑t ${type === 'pickup' ? 'ƒëi·ªÉm ƒë√≥n' : 'ƒëi·ªÉm ƒë·∫øn'}`);
            } catch (error) {
                console.error('Reverse geocoding error:', error);
                const input = document.getElementById(type + 'Input');
                input.value = `${longPressLat.toFixed(6)}, ${longPressLng.toFixed(6)}`;
                input.dataset.lat = longPressLat;
                input.dataset.lng = longPressLng;

                setMarker(type, longPressLat, longPressLng);
                updateRoute();
            }
        }

        // =============================================
        // CUSTOM VALIDATION MESSAGES
        // =============================================
        const pickupInputField = document.getElementById('pickupInput');
        const dropoffInputField = document.getElementById('dropoffInput');
        const phoneInputField = document.getElementById('phoneInput');

        // Custom validation cho ƒëi·ªÉm ƒë√≥n
        pickupInputField.oninvalid = function(e) {
            e.target.setCustomValidity('');
            if (!e.target.value) {
                e.target.setCustomValidity('Vui l√≤ng nh·∫≠p ƒëi·ªÉm ƒë√≥n');
            }
        };

        pickupInputField.oninput = function(e) {
            e.target.setCustomValidity('');
        };

        // Custom validation cho ƒëi·ªÉm ƒë·∫øn
        dropoffInputField.oninvalid = function(e) {
            e.target.setCustomValidity('');
            if (!e.target.value) {
                e.target.setCustomValidity('Vui l√≤ng nh·∫≠p ƒëi·ªÉm ƒë·∫øn');
            }
        };

        dropoffInputField.oninput = function(e) {
            e.target.setCustomValidity('');
        };

        // Custom validation cho s·ªë ƒëi·ªán tho·∫°i
        phoneInputField.oninvalid = function(e) {
            e.target.setCustomValidity('');
            if (!e.target.value) {
                e.target.setCustomValidity('Vui l√≤ng nh·∫≠p SƒêT c·ªßa b·∫°n');
            } else {
                e.target.setCustomValidity('Vui l√≤ng nh·∫≠p SƒêT c·ªßa b·∫°n');
            }
        };

        phoneInputField.oninput = function(e) {
            e.target.setCustomValidity('');
        };

        // =============================================
        // GPS CONFIRM MODAL
        // =============================================
        const gpsConfirmModal = document.getElementById('gpsConfirmModal');
        const gpsLoading = document.getElementById('gpsLoading');

        // Hi·ªán modal khi v√†o trang (m·ªói l·∫ßn)
        setTimeout(() => {
            gpsConfirmModal.classList.add('show');
        }, 1000);

        function acceptGPS() {
            if (!navigator.geolocation) {
                showToast('‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS');
                declineGPS();
                return;
            }

            // Hi·ªán loading
            gpsLoading.classList.add('show');

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const { latitude, longitude } = position.coords;

                    try {
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`
                        );
                        const data = await response.json();

                        const pickupInput = document.getElementById('pickupInput');
                        pickupInput.value = data.display_name || `${latitude}, ${longitude}`;
                        pickupInput.dataset.lat = latitude;
                        pickupInput.dataset.lng = longitude;

                        setMarker('pickup', latitude, longitude);

                        // ƒê√≥ng modal
                        gpsConfirmModal.classList.remove('show');

                        showToast('‚úÖ ƒê√£ ƒë·∫∑t ƒëi·ªÉm ƒë√≥n t·∫°i v·ªã tr√≠ hi·ªán t·∫°i!');

                        // Focus v√†o √¥ ƒëi·ªÉm ƒë·∫øn
                        setTimeout(() => {
                            document.getElementById('dropoffInput').focus();
                        }, 500);

                    } catch (error) {
                        console.error('Error:', error);
                        showToast('‚ùå Kh√¥ng th·ªÉ l·∫•y ƒë·ªãa ch·ªâ');
                        gpsLoading.classList.remove('show');
                    }
                },
                (error) => {
                    console.error('GPS error:', error);
                    gpsLoading.classList.remove('show');

                    if (error.code === 1) {
                        showToast('‚ùå Vui l√≤ng cho ph√©p truy c·∫≠p v·ªã tr√≠');
                    } else {
                        showToast('‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ GPS');
                    }

                    setTimeout(() => {
                        declineGPS();
                    }, 2000);
                },
                { enableHighAccuracy: true, timeout: 15000 }
            );
        }

        function declineGPS() {
            gpsConfirmModal.classList.remove('show');
            showToast('üí° Vui l√≤ng nh·∫≠p ƒëi·ªÉm ƒë√≥n');

            // Nh·∫Øc l·∫°i sau 15 gi√¢y n·∫øu ch∆∞a c√≥ ƒëi·ªÉm ƒë√≥n
            setTimeout(() => {
                const pickupInput = document.getElementById('pickupInput');

                // N·∫øu v·∫´n ch∆∞a nh·∫≠p ƒëi·ªÉm ƒë√≥n, nh·∫Øc b·∫≠t GPS l·∫°i
                if (!pickupInput.dataset.lat) {
                    gpsConfirmModal.classList.add('show');
                }
            }, 15000); // 15 gi√¢y
        }

        // Ki·ªÉm tra GPS permission li√™n t·ª•c khi v√†o trang
        let gpsCheckInterval;
        function startGPSReminder() {
            // Check m·ªói 20 gi√¢y
            gpsCheckInterval = setInterval(() => {
                const pickupInput = document.getElementById('pickupInput');
                const isModalShowing = gpsConfirmModal.classList.contains('show');

                // N·∫øu ch∆∞a c√≥ ƒëi·ªÉm ƒë√≥n v√† modal kh√¥ng hi·ªán
                if (!pickupInput.dataset.lat && !isModalShowing) {
                    gpsConfirmModal.classList.add('show');
                }
            }, 20000); // 20 gi√¢y
        }

        // B·∫Øt ƒë·∫ßu reminder (ch·ªâ tr√™n mobile)
        if (window.innerWidth <= 900) {
            startGPSReminder();
        }

        // D·ª´ng reminder khi ƒë√£ c√≥ ƒëi·ªÉm ƒë√≥n
        document.getElementById('pickupInput').addEventListener('input', function() {
            if (this.dataset.lat && gpsCheckInterval) {
                clearInterval(gpsCheckInterval);
            }
        });
    </script>
</body>
</html>
